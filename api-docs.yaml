openapi: 3.0.0
info:
  title: DoorStep Campus Food Delivery API
  description: API for a campus food delivery platform supporting vendors, steppers, and customers.
  version: 1.0.0
servers:
  - url: https://<your-domain>/api
    description: Production server
  - url: http://localhost:3000/api
    description: Local development server
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    User:
      type: object
      properties:
        id: { type: string, format: uuid }
        email: { type: string, format: email }
        name: { type: string }
        phone: { type: string }
        role: { type: string, enum: [vendor, stepper, customer] }
        created_at: { type: string, format: date-time }
        updated_at: { type: string, format: date-time }
    Vendor:
      type: object
      properties:
        id: { type: string, format: uuid }
        shop_name: { type: string }
        logo_url: { type: string }
        location:
          type: object
          properties:
            type: { type: string, enum: [Point] }
            coordinates:
              type: array
              items: { type: number }
              minItems: 2
              maxItems: 2
        hours:
          type: object
          properties:
            open: { type: string }
            close: { type: string }
        created_at: { type: string, format: date-time }
        updated_at: { type: string, format: date-time }
    Product:
      type: object
      properties:
        id: { type: string, format: uuid }
        vendor_id: { type: string, format: uuid }
        name: { type: string }
        price: { type: number }
        description: { type: string }
        photo_url: { type: string }
        available: { type: boolean }
        created_at: { type: string, format: date-time }
        updated_at: { type: string, format: date-time }
    Order:
      type: object
      properties:
        id: { type: string, format: uuid }
        customer_id: { type: string, format: uuid }
        vendor_id: { type: string, format: uuid }
        stepper_id: { type: string, format: uuid, nullable: true }
        status: { type: string, enum: [placed, accepted, preparing, ready, out_for_delivery, delivered, completed] }
        total: { type: number }
        created_at: { type: string, format: date-time }
        updated_at: { type: string, format: date-time }
    Wallet:
      type: object
      properties:
        id: { type: string, format: uuid }
        stepper_id: { type: string, format: uuid }
        balance: { type: number }
        deposit_amount: { type: number }
        deposit_growth: { type: number }
        created_at: { type: string, format: date-time }
        updated_at: { type: string, format: date-time }
    CommissionHistory:
      type: object
      properties:
        id: { type: string, format: uuid }
        stepper_id: { type: string, format: uuid }
        order_id: { type: string, format: uuid }
        amount: { type: number }
        created_at: { type: string, format: date-time }
    WithdrawalRequest:
      type: object
      properties:
        id: { type: string, format: uuid }
        stepper_id: { type: string, format: uuid }
        amount: { type: number }
        status: { type: string, enum: [pending, approved, rejected] }
        two_factor_code: { type: string }
        created_at: { type: string, format: date-time }
        updated_at: { type: string, format: date-time }
    Notification:
      type: object
      properties:
        id: { type: string, format: uuid }
        user_id: { type: string, format: uuid }
        message: { type: string }
        type: { type: string, enum: [order_update, rating, promotion] }
        read: { type: boolean }
        created_at: { type: string, format: date-time }
    Customer:
      type: object
      properties:
        id: { type: string, format: uuid }
        hall: { type: string }
        created_at: { type: string, format: date-time }
        updated_at: { type: string, format: date-time }
    Stepper:
      type: object
      properties:
        id: { type: string, format: uuid }
        student_id_url: { type: string }
        verification_form_url: { type: string }
        picture_url: { type: string }
        rating: { type: number }
        location:
          type: object
          nullable: true
          properties:
            type: { type: string, enum: [Point] }
            coordinates:
              type: array
              items: { type: number }
              minItems: 2
              maxItems: 2
        created_at: { type: string, format: date-time }
        updated_at: { type: string, format: date-time }
    RatingCreateInput:
      type: object
      properties:
        vendor_rating: { type: integer, minimum: 1, maximum: 5 }
        stepper_rating: { type: integer, minimum: 1, maximum: 5 }
        feedback: { type: string }
    SignupInput:
      type: object
      required: [email, password, role, name]
      properties:
        email: { type: string, format: email }
        password: { type: string, minLength: 8 }
        role: { type: string, enum: [vendor, stepper, customer] }
        name: { type: string }
        phone: { type: string }
    LoginInput:
      type: object
      required: [email, password]
      properties:
        email: { type: string, format: email }
        password: { type: string, minLength: 8 }
    OtpInput:
      type: object
      required: [email]
      properties:
        email: { type: string, format: email }
    VerifyOtpInput:
      type: object
      required: [email, otp]
      properties:
        email: { type: string, format: email }
        otp: { type: string, minLength: 6, maxLength: 6 }
    UpdateProfileInput:
      type: object
      properties:
        name: { type: string }
        phone: { type: string }
        hall: { type: string }
    VendorRegisterForm:
      type: object
      properties:
        shop_name: { type: string }
        logo: { type: string, format: binary }
        location:
          type: string
          description: JSON string of { lat: number, lng: number }
          example: '{"lat":5.560, "lng":-0.205}'
        hours:
          type: string
          description: JSON string of { open: string, close: string }
          example: '{"open":"09:00","close":"17:00"}'
    StepperRegisterForm:
      type: object
      properties:
        student_id: { type: string, format: binary }
        verification_form: { type: string, format: binary }
    StepperProfileUpdateForm:
      type: object
      properties:
        picture: { type: string, format: binary }
        phone: { type: string }
    OrderStatusInput:
      type: object
      required: [status]
      properties:
        status: { type: string, enum: [pending, preparing, ready, completed] }
    StepperDepositInput:
      type: object
      required: [amount]
      properties:
        amount: { type: number, minimum: 0 }
    WithdrawalInput:
      type: object
      required: [amount, two_factor_code]
      properties:
        amount: { type: number, minimum: 0 }
        two_factor_code: { type: string }
    CustomerRegisterInput:
      type: object
      required: [name, hall]
      properties:
        name: { type: string }
        hall: { type: string }
        phone: { type: string }
    OrderCreateInput:
      type: object
      required: [items, payment_details]
      properties:
        items:
          type: array
          items:
            type: object
            required: [product_id, quantity]
            properties:
              product_id: { type: string, format: uuid }
              quantity: { type: integer, minimum: 1 }
        payment_details: { type: object, additionalProperties: true }
    GeolocationUpdateInput:
      type: object
      required: [location]
      properties:
        location:
          type: object
          required: [lat, lng]
          properties:
            lat: { type: number }
            lng: { type: number }
    NotificationPushInput:
      type: object
      required: [user_id, message, type]
      properties:
        user_id: { type: string, format: uuid }
        message: { type: string }
        type: { type: string, enum: [order_update, rating, promotion] }
paths:
  /auth/signup:
    post:
      summary: Register a new user
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignupInput'
      responses:
        '200':
          description: User created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  token: { type: string }
                  user: { $ref: '#/components/schemas/User' }
                  message: { type: string }
        '400': { description: Validation or creation error }
  /auth/login:
    post:
      summary: Authenticate user and return JWT token
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginInput'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  token: { type: string }
                  user: { $ref: '#/components/schemas/User' }
                  message: { type: string }
        '401': { description: Invalid credentials }
  /auth/otp:
    post:
      summary: Send OTP for email/phone verification
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OtpInput'
      responses:
        '200': { description: OTP sent successfully }
        '400': { description: Invalid email or failed to send }
  /auth/verify-otp:
    post:
      summary: Verify OTP for user authentication
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VerifyOtpInput'
      responses:
        '200':
          description: OTP verified successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  token: { type: string }
                  user: { $ref: '#/components/schemas/User' }
                  message: { type: string }
        '400': { description: Invalid OTP }
  /auth/profile:
    put:
      summary: Update user profile
      tags: [Authentication]
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProfileInput'
      responses:
        '200': { description: Profile updated successfully }
        '401': { description: Unauthorized }
  /auth/logout:
    post:
      summary: Invalidate user session
      tags: [Authentication]
      security:
        - BearerAuth: []
      responses:
        '200': { description: Signed out successfully }
        '401': { description: Unauthorized }
  /vendor/register:
    post:
      summary: Register vendor with shop details
      tags: [Vendor]
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/VendorRegisterForm'
      responses:
        '201': { description: Vendor registered successfully }
        '401': { description: Unauthorized }
  /vendor/profile:
    put:
      summary: Update vendor profile
      tags: [Vendor]
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/VendorRegisterForm'
      responses:
        '200': { description: Vendor profile updated }
        '401': { description: Unauthorized }
  /vendor/profile/{id}:
    get:
      summary: Fetch vendor profile by ID
      tags: [Vendor]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses:
        '200': { description: Vendor profile returned }
        '404': { description: Vendor not found }
  /vendor/products:
    get:
      summary: List all products for a vendor
      tags: [Vendor]
      security:
        - BearerAuth: []
      parameters:
        - name: limit
          in: query
          schema: { type: integer, default: 10 }
        - name: offset
          in: query
          schema: { type: integer, default: 0 }
      responses:
        '200':
          description: Paginated products
          content:
            application/json:
              schema:
                type: object
                properties:
                  products:
                    type: array
                    items: { $ref: '#/components/schemas/Product' }
                  total: { type: integer }
                  limit: { type: integer }
                  offset: { type: integer }
        '401': { description: Unauthorized }
  /vendor/products/{id}:
    delete:
      summary: Delete a product
      tags: [Vendor]
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses:
        '200': { description: Product deleted }
        '401': { description: Unauthorized }
        '404': { description: Product not found }
  /vendor/orders:
    get:
      summary: List incoming orders for the vendor
      tags: [Vendor]
      security:
        - BearerAuth: []
      parameters:
        - name: limit
          in: query
          schema: { type: integer, default: 10 }
        - name: offset
          in: query
          schema: { type: integer, default: 0 }
      responses:
        '200':
          description: Paginated orders
          content:
            application/json:
              schema:
                type: object
                properties:
                  orders:
                    type: array
                    items: { $ref: '#/components/schemas/Order' }
                  total: { type: integer }
                  limit: { type: integer }
                  offset: { type: integer }
        '401': { description: Unauthorized }
  /vendor/orders/{id}/status:
    put:
      summary: Update order status
      tags: [Vendor]
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/OrderStatusInput' }
      responses:
        '200': { description: Order status updated }
        '401': { description: Unauthorized }
        '404': { description: Order not found }
  /vendor/analytics/sales:
    get:
      summary: Fetch daily/weekly sales reports
      tags: [Vendor]
      security:
        - BearerAuth: []
      responses:
        '501': { description: Not implemented }
        '401': { description: Unauthorized }
  /vendor/analytics/products:
    get:
      summary: Fetch product performance data
      tags: [Vendor]
      security:
        - BearerAuth: []
      responses:
        '501': { description: Not implemented }
        '401': { description: Unauthorized }
  /stepper/register:
    post:
      summary: Register stepper with student ID and verification form
      tags: [Stepper]
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema: { $ref: '#/components/schemas/StepperRegisterForm' }
      responses:
        '201': { description: Stepper registered }
        '401': { description: Unauthorized }
  /stepper/deposit:
    post:
      summary: Process security deposit
      tags: [Stepper]
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/StepperDepositInput' }
      responses:
        '200': { description: Deposit processed }
        '401': { description: Unauthorized }
  /stepper/profile:
    put:
      summary: Update stepper profile
      tags: [Stepper]
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema: { $ref: '#/components/schemas/StepperProfileUpdateForm' }
      responses:
        '200': { description: Stepper profile updated }
        '401': { description: Unauthorized }
  /stepper/profile/{id}:
    get:
      summary: Fetch stepper profile by ID
      tags: [Stepper]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses:
        '200': { description: Stepper profile returned }
        '404': { description: Stepper not found }
  /stepper/orders/available:
    get:
      summary: List nearby orders based on geolocation
      tags: [Stepper]
      security:
        - BearerAuth: []
      parameters:
        - name: limit
          in: query
          schema: { type: integer, default: 10 }
        - name: offset
          in: query
          schema: { type: integer, default: 0 }
      responses:
        '200':
          description: Paginated nearby orders
          content:
            application/json:
              schema:
                type: object
                properties:
                  orders:
                    type: array
                    items: { $ref: '#/components/schemas/Order' }
                  total: { type: integer }
                  limit: { type: integer }
                  offset: { type: integer }
        '401': { description: Unauthorized }
  /stepper/orders/{id}/accept:
    post:
      summary: Accept an order
      tags: [Stepper]
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses:
        '200': { description: Order accepted }
        '401': { description: Unauthorized }
        '404': { description: Order not found }
  /stepper/orders/{id}/reject:
    post:
      summary: Reject an order
      tags: [Stepper]
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses:
        '200': { description: Order rejected }
        '401': { description: Unauthorized }
        '404': { description: Order not found }
  /stepper/wallet:
    get:
      summary: Fetch wallet balance and commission history
      tags: [Stepper]
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Wallet details
          content:
            application/json:
              schema:
                type: object
                properties:
                  wallet: { $ref: '#/components/schemas/Wallet' }
                  history:
                    type: array
                    items: { $ref: '#/components/schemas/CommissionHistory' }
        '401': { description: Unauthorized }
  /stepper/wallet/withdraw:
    post:
      summary: Request commission withdrawal
      tags: [Stepper]
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/WithdrawalInput' }
      responses:
        '201': { description: Withdrawal requested }
        '400': { description: Insufficient balance or invalid input }
        '401': { description: Unauthorized }
  /customer/register:
    post:
      summary: Register customer with basic details
      tags: [Customer]
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/CustomerRegisterInput' }
      responses:
        '201': { description: Customer registered }
        '401': { description: Unauthorized }
  /customer/profile:
    put:
      summary: Update customer profile
      tags: [Customer]
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/UpdateProfileInput' }
      responses:
        '200': { description: Customer profile updated }
        '401': { description: Unauthorized }
  /customer/profile/{id}:
    get:
      summary: Fetch customer profile by ID
      tags: [Customer]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses:
        '200': { description: Customer profile returned }
        '404': { description: Customer not found }
  /customer/vendors:
    get:
      summary: List vendors by category or name
      tags: [Customer]
      parameters:
        - name: category
          in: query
          schema: { type: string }
        - name: name
          in: query
          schema: { type: string }
        - name: limit
          in: query
          schema: { type: integer, default: 10 }
        - name: offset
          in: query
          schema: { type: integer, default: 0 }
      responses:
        '200':
          description: Paginated vendors
          content:
            application/json:
              schema:
                type: object
                properties:
                  vendors:
                    type: array
                    items: { $ref: '#/components/schemas/Vendor' }
                  total: { type: integer }
                  limit: { type: integer }
                  offset: { type: integer }
  /customer/vendors/{id}/products:
    get:
      summary: Fetch products for a specific vendor
      tags: [Customer]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
        - name: limit
          in: query
          schema: { type: integer, default: 10 }
        - name: offset
          in: query
          schema: { type: integer, default: 0 }
      responses:
        '200':
          description: Paginated products
          content:
            application/json:
              schema:
                type: object
                properties:
                  products:
                    type: array
                    items: { $ref: '#/components/schemas/Product' }
                  total: { type: integer }
                  limit: { type: integer }
                  offset: { type: integer }
        '404': { description: Vendor not found }
  /customer/cart:
    delete:
      summary: Clear cart
      tags: [Customer]
      security:
        - BearerAuth: []
      responses:
        '200': { description: Cart cleared }
        '401': { description: Unauthorized }
  /customer/orders:
    get:
      summary: List customer’s order history
      tags: [Customer]
      security:
        - BearerAuth: []
      parameters:
        - name: limit
          in: query
          schema: { type: integer, default: 10 }
        - name: offset
          in: query
          schema: { type: integer, default: 0 }
      responses:
        '200':
          description: Paginated orders
          content:
            application/json:
              schema:
                type: object
                properties:
                  orders:
                    type: array
                    items: { $ref: '#/components/schemas/Order' }
                  total: { type: integer }
                  limit: { type: integer }
                  offset: { type: integer }
        '401': { description: Unauthorized }
  /customer/orders/{id}:
    get:
      summary: Track order status
      tags: [Customer]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses:
        '200': { description: Order details returned }
        '400': { description: Order ID required }
        '404': { description: Order not found }
  /customer/orders/{id}/rate:
    post:
      summary: Submit ratings and feedback
      tags: [Customer]
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/RatingCreateInput' }
      responses:
        '201': { description: Rating submitted }
        '401': { description: Unauthorized }
        '404': { description: Order not found }
  /geolocation/stepper:
    post:
      summary: Update stepper’s current location
      tags: [Geolocation]
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/GeolocationUpdateInput' }
      responses:
        '200': { description: Location updated }
        '401': { description: Unauthorized }
  /geolocation/orders/nearby:
    get:
      summary: Fetch nearby orders for steppers
      tags: [Geolocation]
      security:
        - BearerAuth: []
      parameters:
        - name: limit
          in: query
          schema: { type: integer, default: 10 }
        - name: offset
          in: query
          schema: { type: integer, default: 0 }
      responses:
        '200':
          description: Paginated nearby orders
          content:
            application/json:
              schema:
                type: object
                properties:
                  orders:
                    type: array
                    items: { $ref: '#/components/schemas/Order' }
                  total: { type: integer }
                  limit: { type: integer }
                  offset: { type: integer }
        '400': { description: Stepper location not set }
        '401': { description: Unauthorized }
  /geolocation/track/{orderId}:
    get:
      summary: Track delivery location for active orders
      tags: [Geolocation]
      security:
        - BearerAuth: []
      parameters:
        - name: orderId
          in: path
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Location data
          content:
            application/json:
              schema:
                type: object
                properties:
                  location:
                    type: object
                    properties:
                      type: { type: string, enum: [Point] }
                      coordinates:
                        type: array
                        items: { type: number }
                        minItems: 2
                        maxItems: 2
        '400': { description: Order ID required }
        '401': { description: Unauthorized }
        '404': { description: Order or location not found }
  /payments/deposit:
    post:
      summary: Process stepper’s security deposit
      tags: [Payments]
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/StepperDepositInput' }
      responses:
        '200': { description: Deposit processed }
        '401': { description: Unauthorized }
  /payments/order:
    post:
      summary: Process customer payment for order
      tags: [Payments]
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/OrderCreateInput' }
      responses:
        '200': { description: Payment processed }
        '401': { description: Unauthorized }
  /payments/withdrawal:
    post:
      summary: Process stepper withdrawal request
      tags: [Payments]
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/WithdrawalInput' }
      responses:
        '201': { description: Withdrawal requested }
        '400': { description: Insufficient balance or invalid input }
        '401': { description: Unauthorized }
  /payments/deposit/growth:
    get:
      summary: Fetch mutual fund investment growth for steppers
      tags: [Payments]
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Deposit growth value
          content:
            application/json:
              schema:
                type: object
                properties:
                  growth: { type: number }
        '401': { description: Unauthorized }
        '404': { description: Wallet not found }
  /notifications/push:
    post:
      summary: Send push notifications
      tags: [Notifications]
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/NotificationPushInput' }
      responses:
        '200': { description: Notification sent }
        '401': { description: Unauthorized }